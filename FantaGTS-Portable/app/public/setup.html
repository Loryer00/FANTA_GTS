<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FantaGTS - Configurazione Sistema</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            min-height: 100vh;
            color: #e2e8f0;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .section {
            background: rgba(255,255,255,0.08);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .section h2 {
            margin-bottom: 20px;
            color: #4299e1;
            border-bottom: 2px solid #4299e1;
            padding-bottom: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            margin-bottom: 5px;
            font-weight: bold;
            color: #cbd5e0;
        }

        .input-group input {
            padding: 10px;
            border: none;
            border-radius: 8px;
            background: rgba(255,255,255,0.95);
            color: #2d3748;
            font-size: 1em;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .btn-primary {
            background: #4299e1;
            color: white;
            border-color: #4299e1;
        }

        .btn-primary:hover {
            background: #3182ce;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(66, 153, 225, 0.4);
        }

        .btn-secondary {
            background: #4a5568;
            color: #e2e8f0;
            border-color: #4a5568;
        }

        .btn-secondary:hover {
            background: #2d3748;
            box-shadow: 0 4px 12px rgba(74, 85, 104, 0.4);
        }

        .btn-danger {
            background: #f56565;
            color: white;
            border-color: #f56565;
        }

        .btn-danger:hover {
            background: #e53e3e;
            box-shadow: 0 4px 12px rgba(245, 101, 101, 0.4);
        }

        .squadre-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .squadra-card {
            background: rgba(255,255,255,0.08);
            border-radius: 10px;
            padding: 15px;
            border-left: 5px solid;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .squadra-card.rosso { border-left-color: #f56565; }
        .squadra-card.blu { border-left-color: #4299e1; }
        .squadra-card.verde { border-left-color: #48bb78; }
        .squadra-card.giallo { border-left-color: #ed8936; }
        .squadra-card.arancione { border-left-color: #f6ad55; }
        .squadra-card.viola { border-left-color: #9f7aea; }
        .squadra-card.rosa { border-left-color: #ed64a6; }
        .squadra-card.marrone { border-left-color: #a0aec0; }
		.squadra-card.smeraldo { border-left-color: #10b981; }
        .squadra-card.royal { border-left-color: #1e40af; }
        .squadra-card.ciano { border-left-color: #06b6d4; }
        .squadra-card.lime { border-left-color: #84cc16; }
        .squadra-card.bordeaux { border-left-color: #7c2d12; }
        .squadra-card.crema { border-left-color: #fef3c7; }
        .squadra-card.lilla { border-left-color: #c4b5fd; }

        .squadra-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .giocatori-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }

        .status-indicator {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
        }

        .status-success {
            background: rgba(72, 187, 120, 0.2);
            border: 2px solid #48bb78;
            color: #68d391;
        }

        .status-warning {
            background: rgba(237, 137, 54, 0.2);
            border: 2px solid #ed8936;
            color: #f6ad55;
        }

        .status-error {
            background: rgba(245, 101, 101, 0.2);
            border: 2px solid #f56565;
            color: #fc8181;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: #4299e1;
            transition: width 0.3s ease;
        }

        .info-box {
            background: rgba(66, 153, 225, 0.15);
            border: 2px solid #4299e1;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .info-box h3 {
            color: #63b3ed;
            margin-bottom: 10px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            z-index: 1001;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: #48bb78;
        }

        .notification.error {
            background: #f56565;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: #4299e1;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
</style>

</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéæ FantaGTS - Configurazione Squadre</h1>
            <p>Configura le squadre del circolo e prepara il sistema per le aste</p>
        </div>

        <!-- Stato Sistema -->
        <div class="section">
            <h2>üìä Stato Sistema</h2>
            <div id="systemStatus" class="status-indicator status-warning">
                <div class="loading"></div> Caricamento stato sistema...
            </div>
            <div class="progress-bar">
                <div id="setupProgress" class="progress-fill" style="width: 0%"></div>
            </div>
            <p id="setupDescription">Inizializzazione in corso...</p>
        </div>

        <!-- Info Partecipanti -->
        <div class="info-box">
            <h3>üë• Registrazione Partecipanti</h3>
            <p><strong>I partecipanti si registreranno autonomamente</strong> connettendosi all'app da smartphone/tablet/PC.</p>
            <p>Condividi questo link con i partecipanti: <strong>http://[TUO_IP]:3000</strong></p>
            <p>Potrai vedere i partecipanti connessi nel pannello Master una volta completata la configurazione.</p>
        </div>

        <!-- Setup Squadre Circolo -->
<div class="section">
    <h2>üèÜ Squadre del Circolo</h2>
    <p>Configura le squadre del circolo tennis con i loro giocatori</p>
    
    <!-- Bottone principale per aggiungere squadra -->
    <div style="text-align: center; margin-bottom: 20px;">
        <button class="btn btn-primary" onclick="mostraOpzioniAggiunta()" id="btnAggiungiSquadra">
            ‚ûï Aggiungi Squadra
        </button>
    </div>

    <!-- Opzioni di aggiunta (inizialmente nascoste) -->
    <div id="opzioniAggiunta" style="display: none; text-align: center; margin-bottom: 30px; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 10px;">
        <h3>Come vuoi aggiungere la squadra?</h3>
        <div style="margin-top: 15px;">
            <button class="btn btn-primary" onclick="mostraUploadFile()" style="margin: 0 10px;">
                üìÅ Da File (.txt)
            </button>
            <button class="btn btn-primary" onclick="mostraFormManuale()" style="margin: 0 10px;">
                ‚úèÔ∏è Da Interfaccia
            </button>
        </div>
        <button class="btn btn-secondary" onclick="nascondiOpzioni()" style="margin-top: 10px;">
            ‚ùå Annulla
        </button>
    </div>

    <!-- Upload da file -->
    <div id="uploadSection" style="display: none; margin-bottom: 30px; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 10px;">
        <h3>üìÅ Upload Squadra da File</h3>
        <div class="info-box" style="margin-bottom: 15px;">
            <h4>Formato file .txt richiesto:</h4>
            <pre style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 5px; font-size: 0.9em;">Squadra Gialla
M1 Spano
M2 Cavo A
M3 Paqualetto
M4 Cosini
M5 Cassanello
M6 Paladino
M7 Ferrari P
F1 Tambroni B
F2 Frojo F
F3 Brunelli E</pre>
        </div>
        <input type="file" id="fileSquadra" accept=".txt" style="margin-bottom: 15px; padding: 10px; background: rgba(255,255,255,0.9); border-radius: 5px; width: 100%;">
        <div>
            <button class="btn btn-primary" onclick="caricaSquadraDaFile()">
                üöÄ Carica Squadra
            </button>
            <button class="btn btn-secondary" onclick="annullaUpload()">
                ‚ùå Annulla
            </button>
        </div>
    </div>

    <!-- Form manuale (versione semplificata) -->
    <div id="formManualeSection" style="display: none; margin-bottom: 30px; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 10px;">
        <h3>‚úèÔ∏è Inserimento Manuale</h3>
        
        <div class="input-group" style="margin-bottom: 15px;">
            <label>Colore Squadra:</label>
            <input type="text" id="coloreSquadraManuale" placeholder="es: rosso, verde, azzurro, fucsia..." autocomplete="off" style="width: 100%; padding: 10px; border: none; border-radius: 8px; background: rgba(255,255,255,0.9); color: #333;">
        </div>

        <div style="display: grid; grid-template-columns: 1fr; gap: 10px; margin-bottom: 20px;">
            <div class="input-group">
                <label>M1:</label>
                <input type="text" id="m1_manuale" placeholder="Nome giocatore M1">
            </div>
            <div class="input-group">
                <label>M2:</label>
                <input type="text" id="m2_manuale" placeholder="Nome giocatore M2">
            </div>
            <div class="input-group">
                <label>M3:</label>
                <input type="text" id="m3_manuale" placeholder="Nome giocatore M3">
            </div>
            <div class="input-group">
                <label>M4:</label>
                <input type="text" id="m4_manuale" placeholder="Nome giocatore M4">
            </div>
            <div class="input-group">
                <label>M5:</label>
                <input type="text" id="m5_manuale" placeholder="Nome giocatore M5">
            </div>
            <div class="input-group">
                <label>M6:</label>
                <input type="text" id="m6_manuale" placeholder="Nome giocatore M6">
            </div>
            <div class="input-group">
                <label>M7:</label>
                <input type="text" id="m7_manuale" placeholder="Nome giocatore M7">
            </div>
            <div class="input-group">
                <label>F1:</label>
                <input type="text" id="f1_manuale" placeholder="Nome giocatrice F1">
            </div>
            <div class="input-group">
                <label>F2:</label>
                <input type="text" id="f2_manuale" placeholder="Nome giocatrice F2">
            </div>
            <div class="input-group">
                <label>F3:</label>
                <input type="text" id="f3_manuale" placeholder="Nome giocatrice F3">
            </div>
        </div>

        <div>
            <button class="btn btn-primary" onclick="aggiungiSquadraManuale()">
                ‚ûï Aggiungi Squadra
            </button>
            <button class="btn btn-secondary" onclick="clearFormManualeEChiudi()">
                ‚ùå Annulla
            </button>
        </div>
    </div>

    <div id="squadreList" class="squadre-grid">
        <!-- Le squadre verranno caricate qui -->
    </div>
</div>

        <!-- Finalizzazione Setup -->
        <div class="section">
            <h2>üöÄ Finalizzazione Setup</h2>
            <p>Completa la configurazione e prepara il sistema per le aste</p>
            
            <div id="setupSummary">
                <p>üìä <strong>Squadre configurate:</strong> <span id="countSquadre">0</span></p>
                <p>üéØ <strong>Slots da generare:</strong> <span id="countSlots">0</span> (10 per squadra)</p>
                <p>üë• <strong>Partecipanti:</strong> Si registreranno connettendosi all'app</p>
            </div>

            <div style="margin-top: 20px;">
                <button class="btn btn-primary" onclick="generaSlots()" id="btnGeneraSlots" disabled>
                    üéØ Genera Slots Giocatori
                </button>
                <button class="btn btn-primary" onclick="vaiAMaster()" id="btnVaiMaster" disabled>
                    üéÆ Vai al Pannello Master
                </button>
                <button class="btn btn-danger" onclick="resetSistema()">
                    üîÑ Reset Completo
                </button>
            </div>
        </div>
    </div>

    <script>
        let squadre = [];
        let systemReady = false;

        // Inizializzazione
        document.addEventListener('DOMContentLoaded', () => {
            caricaStato();
            caricaSquadre();
        });

        // Gestione stato sistema
        async function caricaStato() {
            try {
                const response = await fetch('/api/stato');
                const stato = await response.json();
                
                updateSystemStatus();
            } catch (error) {
                console.error('Errore caricamento stato:', error);
                showNotification('Errore caricamento stato sistema', 'error');
            }
        }

        function updateSystemStatus() {
            const statusEl = document.getElementById('systemStatus');
            const progressEl = document.getElementById('setupProgress');
            const descEl = document.getElementById('setupDescription');
            
            let progress = 0;
            let status = 'warning';
            let message = 'Configurazione in corso...';

            // Calcola progresso (ora solo squadre + slots)
            if (squadre.length > 0) progress += 70; // Peso maggiore alle squadre
            if (systemReady) progress += 30; // Slots generati

            if (progress === 100) {
                status = 'success';
                message = '‚úÖ Sistema pronto per le aste!';
            } else if (progress >= 70) {
                status = 'warning';
                message = '‚ö†Ô∏è Quasi pronto - genera i slots giocatori';
            } else {
                status = 'error';
                message = '‚ùå Configura prima le squadre del circolo';
            }

            statusEl.className = `status-indicator status-${status}`;
            statusEl.innerHTML = message;
            progressEl.style.width = `${progress}%`;
            descEl.textContent = getProgressDescription(progress);

            updateButtons();
            updateSummary();
        }

        function getProgressDescription(progress) {
            if (progress >= 100) return 'Sistema completamente configurato e pronto!';
            if (progress >= 70) return 'Squadre configurate, genera ora i slots';
            if (progress >= 30) return 'Continua configurando le squadre del circolo';
            return 'Inizia configurando le squadre del circolo';
        }

        function updateButtons() {
            const btnGenera = document.getElementById('btnGeneraSlots');
            const btnMaster = document.getElementById('btnVaiMaster');
            
            btnGenera.disabled = squadre.length === 0;
            btnMaster.disabled = !systemReady;
        }

        function updateSummary() {
            document.getElementById('countSquadre').textContent = squadre.length;
            document.getElementById('countSlots').textContent = squadre.length * 10;
        }

        // Gestione squadre
        async function caricaSquadre() {
            try {
                const response = await fetch('/api/squadre');
                squadre = await response.json();
                renderSquadre();
                updateSystemStatus();
            } catch (error) {
                console.error('Errore caricamento squadre:', error);
                showNotification('Errore caricamento squadre', 'error');
            }
        }

// Gestione opzioni aggiunta squadra
function mostraOpzioniAggiunta() {
    document.getElementById('opzioniAggiunta').style.display = 'block';
    document.getElementById('btnAggiungiSquadra').style.display = 'none';
}

function nascondiOpzioni() {
    document.getElementById('opzioniAggiunta').style.display = 'none';
    document.getElementById('uploadSection').style.display = 'none';
    document.getElementById('formManualeSection').style.display = 'none';
    document.getElementById('btnAggiungiSquadra').style.display = 'block';
}

function mostraUploadFile() {
    document.getElementById('opzioniAggiunta').style.display = 'none';
    document.getElementById('uploadSection').style.display = 'block';
}

function mostraFormManuale() {
    document.getElementById('opzioniAggiunta').style.display = 'none';
    document.getElementById('formManualeSection').style.display = 'block';
}

// Upload da file
async function caricaSquadraDaFile() {
    const fileInput = document.getElementById('fileSquadra');
    const file = fileInput.files[0];
    
    if (!file) {
        showNotification('Seleziona un file .txt', 'error');
        return;
    }
    
    if (!file.name.endsWith('.txt')) {
        showNotification('Il file deve avere estensione .txt', 'error');
        return;
    }
    
    try {
        const text = await file.text();
        const squadra = parseFileSquadra(text);
        
        if (squadra) {
            await salvaSquadra(squadra);
            annullaUpload();
            caricaSquadre();
            showNotification('Squadra caricata con successo dal file!', 'success');
        }
    } catch (error) {
        console.error('Errore lettura file:', error);
        showNotification('Errore nella lettura del file', 'error');
    }
}

function parseFileSquadra(text) {
    const lines = text.split('\n').map(line => line.trim()).filter(line => line.length > 0);
    
    if (lines.length < 1) {
        showNotification('File vuoto o non valido', 'error');
        return null;
    }
    
    // Prima riga: nome squadra (es: "Squadra Gialla")
    const nomeCompleto = lines[0];
    const colore = nomeCompleto.replace(/^squadra\s+/i, '').trim();
    
    if (!colore) {
        showNotification('Nome squadra non valido. Formato: "Squadra Colore"', 'error');
        return null;
    }
    
    const squadra = {
        numero: getNextSquadraNumber(),
        colore: colore.toLowerCase(),
        m1: '', m2: '', m3: '', m4: '', m5: '', m6: '', m7: '',
        f1: '', f2: '', f3: ''
    };
    
    // Parse giocatori
    for (let i = 1; i < lines.length; i++) {
        const line = lines[i];
        const match = line.match(/^([MF]\d+)\s+(.+)$/);
        
        if (match) {
            const posizione = match[1].toLowerCase();
            const nome = match[2].trim();
            
            if (squadra.hasOwnProperty(posizione)) {
                squadra[posizione] = nome;
            } else {
                console.warn(`Posizione non riconosciuta: ${posizione}`);
            }
        } else {
            console.warn(`Riga non valida: ${line}`);
        }
    }
    
    return squadra;
}

function getNextSquadraNumber() {
    // Trova il numero pi√π alto tra le squadre esistenti e aggiungi 1
    let maxNumber = 0;
    squadre.forEach(squadra => {
        if (squadra.numero > maxNumber) {
            maxNumber = squadra.numero;
        }
    });
    return maxNumber + 1;
}

// Form manuale
async function aggiungiSquadraManuale() {
    const colore = document.getElementById('coloreSquadraManuale').value.trim();
    
    if (!colore) {
        showNotification('Inserisci il colore della squadra', 'error');
        return;
    }
    
    const squadra = {
        numero: getNextSquadraNumber(),
        colore: colore.toLowerCase(),
        m1: document.getElementById('m1_manuale').value.trim(),
        m2: document.getElementById('m2_manuale').value.trim(),
        m3: document.getElementById('m3_manuale').value.trim(),
        m4: document.getElementById('m4_manuale').value.trim(),
        m5: document.getElementById('m5_manuale').value.trim(),
        m6: document.getElementById('m6_manuale').value.trim(),
        m7: document.getElementById('m7_manuale').value.trim(),
        f1: document.getElementById('f1_manuale').value.trim(),
        f2: document.getElementById('f2_manuale').value.trim(),
        f3: document.getElementById('f3_manuale').value.trim()
    };
    
    await salvaSquadra(squadra);
    clearFormManualeEChiudi();
    caricaSquadre();
    showNotification('Squadra aggiunta con successo!', 'success');
}

function clearFormManualeEChiudi() {
    ['coloreSquadraManuale', 'm1_manuale', 'm2_manuale', 'm3_manuale', 'm4_manuale', 'm5_manuale', 'm6_manuale', 'm7_manuale', 'f1_manuale', 'f2_manuale', 'f3_manuale']
        .forEach(id => document.getElementById(id).value = '');
    nascondiOpzioni();
}

// Funzione comune per salvare squadra
async function salvaSquadra(squadra) {
    const response = await fetch('/api/squadre', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(squadra)
    });
    
    if (!response.ok) {
        const error = await response.json();
        throw new Error(error.error || 'Errore salvataggio squadra');
    }
    
    return response.json();
}

function annullaUpload() {
    document.getElementById('fileSquadra').value = '';
    nascondiOpzioni();
}

        function renderSquadre() {
            const container = document.getElementById('squadreList');
            container.innerHTML = '';

            squadre.forEach(squadra => {
                const card = document.createElement('div');
                card.className = `squadra-card ${squadra.colore}`;
                card.innerHTML = `
                    <div class="squadra-header">
                        <h3>Squadra ${squadra.numero} - ${squadra.colore.toUpperCase()}</h3>
                        <button class="btn btn-danger btn-sm" onclick="eliminaSquadra(${squadra.numero})" style="padding: 5px 10px; margin: 0;">
                            üóëÔ∏è
                        </button>
                    </div>
                    <div class="giocatori-grid">
                        <div><strong>M1:</strong> ${squadra.m1 || '-'}</div>
                        <div><strong>M2:</strong> ${squadra.m2 || '-'}</div>
                        <div><strong>M3:</strong> ${squadra.m3 || '-'}</div>
                        <div><strong>M4:</strong> ${squadra.m4 || '-'}</div>
                        <div><strong>M5:</strong> ${squadra.m5 || '-'}</div>
                        <div><strong>M6:</strong> ${squadra.m6 || '-'}</div>
                        <div><strong>M7:</strong> ${squadra.m7 || '-'}</div>
                        <div><strong>F1:</strong> ${squadra.f1 || '-'}</div>
                        <div><strong>F2:</strong> ${squadra.f2 || '-'}</div>
                        <div><strong>F3:</strong> ${squadra.f3 || '-'}</div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        async function aggiungiSquadra() {
            const numero = document.getElementById('numeroSquadra').value;
            const colore = document.getElementById('coloreSquadra').value;
            
            if (!numero || !colore) {
                showNotification('Inserisci numero e colore squadra', 'error');
                return;
            }

            const squadra = {
                numero: parseInt(numero),
                colore: colore,
                m1: document.getElementById('m1').value,
                m2: document.getElementById('m2').value,
                m3: document.getElementById('m3').value,
                m4: document.getElementById('m4').value,
                m5: document.getElementById('m5').value,
                m6: document.getElementById('m6').value,
                m7: document.getElementById('m7').value,
                f1: document.getElementById('f1').value,
                f2: document.getElementById('f2').value,
                f3: document.getElementById('f3').value
            };

            try {
                const response = await fetch('/api/squadre', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(squadra)
                });

                if (response.ok) {
                    showNotification('Squadra aggiunta con successo!', 'success');
                    clearFormSquadra();
                    caricaSquadre();
                } else {
                    const error = await response.json();
                    showNotification('Errore: ' + error.error, 'error');
                }
            } catch (error) {
                showNotification('Errore di connessione', 'error');
            }
        }

        function clearFormSquadra() {
            ['numeroSquadra', 'coloreSquadra', 'm1', 'm2', 'm3', 'm4', 'm5', 'm6', 'm7', 'f1', 'f2', 'f3']
                .forEach(id => document.getElementById(id).value = '');
        }

        async function eliminaSquadra(numero) {
            if (!confirm(`Eliminare la squadra ${numero}?`)) return;

            try {
                const response = await fetch(`/api/squadre/${numero}`, { method: 'DELETE' });
                if (response.ok) {
                    showNotification('Squadra eliminata', 'success');
                    caricaSquadre();
                } else {
                    showNotification('Errore eliminazione squadra', 'error');
                }
            } catch (error) {
                showNotification('Errore di connessione', 'error');
            }
        }

        // Finalizzazione
        async function generaSlots() {
            if (squadre.length === 0) {
                showNotification('Configura prima le squadre', 'error');
                return;
            }

            try {
                const response = await fetch('/api/genera-slots', { method: 'POST' });
                if (response.ok) {
                    systemReady = true;
                    showNotification('Slots generati con successo!', 'success');
                    updateSystemStatus();
                } else {
                    const error = await response.json();
                    showNotification('Errore: ' + error.error, 'error');
                }
            } catch (error) {
                showNotification('Errore di connessione', 'error');
            }
        }

        function vaiAMaster() {
            if (systemReady) {
                window.location.href = '/master';
            }
        }

        async function resetSistema() {
            if (!confirm('ATTENZIONE: Questa azione eliminer√† TUTTI i dati del sistema. Procedere?')) {
                return;
            }

            try {
                const response = await fetch('/api/reset/totale', { method: 'POST' });
                if (response.ok) {
                    showNotification('Sistema resettato completamente', 'success');
                    location.reload();
                } else {
                    showNotification('Errore durante il reset', 'error');
                }
            } catch (error) {
                showNotification('Errore di connessione', 'error');
            }
        }

        // Utilities
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Aggiorna stato ogni 10 secondi
        setInterval(caricaStato, 10000);
    </script>
</body>
</html>