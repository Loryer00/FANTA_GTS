<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FantaGTS - Master Control</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            padding: 15px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .section {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .section h2 {
            margin-bottom: 15px;
            color: #ffd700;
            border-bottom: 2px solid #ffd700;
            padding-bottom: 8px;
            font-size: 1.3em;
        }

        .status-card {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid;
        }

        .status-active { border-left-color: #10b981; }
        .status-waiting { border-left-color: #f59e0b; }
        .status-error { border-left-color: #ef4444; }

        .big-timer {
            font-size: 3em;
            text-align: center;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin: 20px 0;
        }

        .timer-critical {
            color: #ef4444;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .rounds-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }

        .round-btn {
            padding: 12px 8px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .round-btn.available {
            background: #10b981;
            color: white;
        }

        .round-btn.active {
            background: #ef4444;
            color: white;
            animation: pulse 2s infinite;
        }

        .round-btn.completed {
            background: #6b7280;
            color: white;
            cursor: not-allowed;
        }

        .round-btn:hover:not(.completed):not(.active) {
            background: #059669;
            transform: translateY(-2px);
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn-primary {
            background: #10b981;
            color: white;
        }

        .btn-primary:hover {
            background: #059669;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-warning {
            background: #f59e0b;
            color: white;
        }

        .btn-warning:hover {
            background: #d97706;
        }

        .btn:disabled {
            background: #6b7280;
            cursor: not-allowed;
            transform: none;
        }

        .participants-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .participant-card {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #10b981;
        }

        .participant-card.bidding {
            border-left-color: #f59e0b;
            background: rgba(245, 158, 11, 0.2);
        }

        .participant-card.offline {
            border-left-color: #6b7280;
            opacity: 0.6;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .results-table th,
        .results-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            font-size: 0.9em;
        }

        .results-table th {
            background: rgba(0,0,0,0.3);
            font-weight: bold;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            color: white;
            max-height: 80vh;
            overflow-y: auto;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            z-index: 1001;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: #10b981;
        }

        .notification.error {
            background: #ef4444;
        }

        .notification.warning {
            background: #f59e0b;
        }

        .live-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            background: #ef4444;
            border-radius: 50%;
            animation: blink 1s infinite;
            margin-right: 8px;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .stat-card {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #ffd700;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .current-round-display {
            background: rgba(239, 68, 68, 0.3);
            border: 3px solid #ef4444;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin: 20px 0;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .bid-status {
            font-size: 0.8em;
            padding: 4px 8px;
            border-radius: 4px;
            margin-top: 5px;
        }

        .bid-confirmed {
            background: #10b981;
            color: white;
        }

        .bid-pending {
            background: #f59e0b;
            color: white;
        }

        .bid-none {
            background: #6b7280;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎮 FantaGTS - Master Control</h1>
            <p>Pannello di controllo per gestire aste e monitorare il torneo</p>
            <div id="serverStatus" class="status-card status-active">
                <span class="live-indicator"></span>
                Server attivo - Connesso
            </div>
        </div>

        <!-- Dashboard Principale -->
        <div class="dashboard-grid">
            <!-- Controllo Aste -->
            <div class="section">
                <h2>🎯 Controllo Aste</h2>
                
                <div id="currentRoundInfo" class="current-round-display" style="display: none;">
                    <h3>Round Attivo: <span id="activeRoundName">M1</span></h3>
                    <div class="big-timer" id="roundTimer">30</div>
                    <p>Tempo rimasto per le offerte</p>
                </div>

                <div class="rounds-grid">
                    <button class="round-btn available" data-round="M1" onclick="avviaRound('M1')">M1</button>
                    <button class="round-btn available" data-round="M2" onclick="avviaRound('M2')">M2</button>
                    <button class="round-btn available" data-round="M3" onclick="avviaRound('M3')">M3</button>
                    <button class="round-btn available" data-round="M4" onclick="avviaRound('M4')">M4</button>
                    <button class="round-btn available" data-round="M5" onclick="avviaRound('M5')">M5</button>
                    <button class="round-btn available" data-round="M6" onclick="avviaRound('M6')">M6</button>
                    <button class="round-btn available" data-round="M7" onclick="avviaRound('M7')">M7</button>
                    <button class="round-btn available" data-round="F1" onclick="avviaRound('F1')">F1</button>
                    <button class="round-btn available" data-round="F2" onclick="avviaRound('F2')">F2</button>
                    <button class="round-btn available" data-round="F3" onclick="avviaRound('F3')">F3</button>
                </div>

                <div style="margin-top: 20px;">
                    <button class="btn btn-primary" id="btnAvviaRound" onclick="avviaRoundSelezionato()" disabled>
                        🚀 Avvia Round Selezionato
                    </button>
                    <button class="btn btn-danger" id="btnFermaRound" onclick="fermaRound()" disabled>
                        ⏹️ Ferma Round
                    </button>
                </div>
            </div>

            <!-- Stato Partecipanti -->
            <div class="section">
                <h2>👥 Partecipanti Connessi</h2>
                <div id="participantsContainer">
                    <div class="loading"></div> Caricamento partecipanti...
                </div>
            </div>

            <!-- Statistiche Live -->
            <div class="section">
                <h2>📊 Statistiche Live</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="statConnessi">0</div>
                        <div class="stat-label">Connessi</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="statOfferte">0</div>
                        <div class="stat-label">Offerte</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="statRounds">0</div>
                        <div class="stat-label">Round Completati</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="statCrediti">0</div>
                        <div class="stat-label">Crediti Spesi</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Risultati Ultimo Round -->
        <div class="section">
            <h2>🏆 Risultati Ultimo Round</h2>
            <div id="lastRoundResults">
                <p>Nessun round completato ancora</p>
            </div>
        </div>

        <!-- Strumenti Admin -->
        <div class="section">
            <h2>🔧 Strumenti Amministrazione</h2>
            <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                <button class="btn btn-primary" onclick="vaiASetup()">
                    ⚙️ Configurazione
                </button>
                <button class="btn btn-primary" onclick="esportaDati()">
                    📊 Esporta Dati
                </button>
                <button class="btn btn-primary" onclick="mostraClassifica()">
                    🏆 Classifica
                </button>
                <button class="btn btn-warning" onclick="resetAste()">
                    🔄 Reset Aste
                </button>
                <button class="btn btn-danger" onclick="resetTotale()">
                    ⚠️ Reset Totale
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Risultati Round -->
    <div id="resultsModal" class="modal">
        <div class="modal-content">
            <h3 id="resultsTitle">Risultati Round</h3>
            <div id="resultsContent"></div>
            <button class="btn btn-primary" onclick="closeModal('resultsModal')" style="margin-top: 20px;">
                Chiudi
            </button>
        </div>
    </div>

    <!-- Modal Classifica -->
    <div id="classificaModal" class="modal">
        <div class="modal-content">
            <h3>🏆 Classifica Generale</h3>
            <div id="classificaContent"></div>
            <button class="btn btn-primary" onclick="closeModal('classificaModal')" style="margin-top: 20px;">
                Chiudi
            </button>
        </div>
    </div>

    <!-- Modal Conferma -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <h3 id="confirmTitle">Conferma Azione</h3>
            <p id="confirmMessage">Sei sicuro di voler procedere?</p>
            <div style="margin-top: 20px; text-align: right;">
                <button class="btn btn-secondary" onclick="closeModal('confirmModal')">Annulla</button>
                <button class="btn btn-primary" id="confirmBtn">Conferma</button>
            </div>
        </div>
    </div>

    <script>
        // Variabili globali
        let socket;
        let gameState = {
            fase: 'waiting',
            roundAttivo: null,
            asteAttive: false,
            tempoRimasto: 0,
            connessi: [],
            ultimiRisultati: null
        };
        let roundSelezionato = null;
        let timerInterval = null;

        // Inizializzazione
        document.addEventListener('DOMContentLoaded', () => {
            initializeSocket();
            caricaStatoIniziale();
            setupEventListeners();
        });

        // Connessione WebSocket
        function initializeSocket() {
            socket = io();

            socket.on('connect', () => {
                showNotification('Connesso al server', 'success');
                updateServerStatus(true);
                
                // Registra come master
                socket.emit('register', {
                    nome: 'Master Control',
                    tipo: 'master'
                });
            });

            socket.on('disconnect', () => {
                showNotification('Disconnesso dal server', 'error');
                updateServerStatus(false);
            });

            socket.on('registered', (data) => {
                if (data.success) {
                    gameState = { ...gameState, ...data.gameState };
                    updateUI();
                }
            });

            socket.on('round_started', (data) => {
                gameState.roundAttivo = data.round;
                gameState.asteAttive = true;
                gameState.tempoRimasto = data.tempo;
                updateUI();
                showNotification(`Round ${data.round} avviato!`, 'success');
                startTimerDisplay();
            });

            socket.on('timer_update', (timeLeft) => {
                gameState.tempoRimasto = timeLeft;
                updateTimerDisplay();
            });

            socket.on('round_ended', (data) => {
                gameState.asteAttive = false;
                gameState.roundAttivo = null;
                gameState.ultimiRisultati = data.risultati;
                updateUI();
                showNotification(`Round ${data.round} terminato!`, 'success');
                stopTimerDisplay();
                mostraRisultatiRound(data.round, data.risultati);
            });

            socket.on('connessi_update', (connessi) => {
                gameState.connessi = connessi;
                updatePartecipanti();
                updateStats();
            });
        }

        function updateServerStatus(connected) {
            const statusEl = document.getElementById('serverStatus');
            if (connected) {
                statusEl.className = 'status-card status-active';
                statusEl.innerHTML = '<span class="live-indicator"></span>Server attivo - Connesso';
            } else {
                statusEl.className = 'status-card status-error';
                statusEl.innerHTML = '❌ Server disconnesso';
            }
        }

        // Caricamento stato iniziale
        async function caricaStatoIniziale() {
            try {
                const response = await fetch('/api/stato');
                const stato = await response.json();
                gameState = { ...gameState, ...stato };
                updateUI();
            } catch (error) {
                console.error('Errore caricamento stato:', error);
                showNotification('Errore caricamento stato', 'error');
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Selezione round
            document.querySelectorAll('.round-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (!btn.classList.contains('completed') && !btn.classList.contains('active')) {
                        selectRound(btn.dataset.round);
                    }
                });
            });
        }

        // Gestione round
        function selectRound(round) {
            // Rimuovi selezione precedente
            document.querySelectorAll('.round-btn').forEach(btn => {
                btn.style.outline = 'none';
            });

            // Seleziona nuovo round
            const btn = document.querySelector(`[data-round="${round}"]`);
            btn.style.outline = '3px solid #ffd700';
            
            roundSelezionato = round;
            document.getElementById('btnAvviaRound').disabled = false;
        }

        async function avviaRound(round) {
            if (gameState.asteAttive) {
                showNotification('Un round è già attivo!', 'warning');
                return;
            }

            try {
                const response = await fetch(`/api/avvia-round/${round}`, {
                    method: 'POST'
                });

                if (response.ok) {
                    // Il socket.io gestirà l'aggiornamento UI
                    document.querySelector(`[data-round="${round}"]`).classList.add('active');
                    document.getElementById('btnAvviaRound').disabled = true;
                    document.getElementById('btnFermaRound').disabled = false;
                } else {
                    const error = await response.json();
                    showNotification('Errore: ' + error.error, 'error');
                }
            } catch (error) {
                showNotification('Errore di connessione', 'error');
            }
        }

        function avviaRoundSelezionato() {
            if (roundSelezionato) {
                avviaRound(roundSelezionato);
            }
        }

        async function fermaRound() {
            if (!gameState.asteAttive) return;

            showConfirmModal(
                'Ferma Round',
                'Vuoi terminare anticipatamente il round corrente?',
                async () => {
                    try {
                        const response = await fetch('/api/ferma-round', {
                            method: 'POST'
                        });

                        if (response.ok) {
                            showNotification('Round fermato', 'success');
                        } else {
                            showNotification('Errore durante stop round', 'error');
                        }
                    } catch (error) {
                        showNotification('Errore di connessione', 'error');
                    }
                }
            );
        }

        // Gestione timer
        function startTimerDisplay() {
            if (timerInterval) clearInterval(timerInterval);
            
            document.getElementById('currentRoundInfo').style.display = 'block';
            document.getElementById('activeRoundName').textContent = gameState.roundAttivo;
            
            timerInterval = setInterval(() => {
                updateTimerDisplay();
            }, 1000);
        }

        function updateTimerDisplay() {
            const timerEl = document.getElementById('roundTimer');
            timerEl.textContent = gameState.tempoRimasto;
            
            if (gameState.tempoRimasto <= 5) {
                timerEl.classList.add('timer-critical');
            } else {
                timerEl.classList.remove('timer-critical');
            }
        }

        function stopTimerDisplay() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            document.getElementById('currentRoundInfo').style.display = 'none';
            
            // Aggiorna stato round button
            if (gameState.roundAttivo) {
                const btn = document.querySelector(`[data-round="${gameState.roundAttivo}"]`);
                if (btn) {
                    btn.classList.remove('active');
                    btn.classList.add('completed');
                }
            }
        }

        // Update UI
        function updateUI() {
            updateRoundButtons();
            updateControlButtons();
            updatePartecipanti();
            updateStats();
        }

        function updateRoundButtons() {
            document.querySelectorAll('.round-btn').forEach(btn => {
                const round = btn.dataset.round;
                
                btn.classList.remove('available', 'active', 'completed');
                
                if (round === gameState.roundAttivo && gameState.asteAttive) {
                    btn.classList.add('active');
                } else {
                    // TODO: Controllare se round è completato dal database
                    btn.classList.add('available');
                }
            });
        }

        function updateControlButtons() {
            document.getElementById('btnAvviaRound').disabled = gameState.asteAttive || !roundSelezionato;
            document.getElementById('btnFermaRound').disabled = !gameState.asteAttive;
        }

        function updatePartecipanti() {
            const container = document.getElementById('participantsContainer');
            
            if (gameState.connessi.length === 0) {
                container.innerHTML = '<p>Nessun partecipante connesso</p>';
                return;
            }

            container.innerHTML = '';
            const grid = document.createElement('div');
            grid.className = 'participants-grid';

            gameState.connessi.forEach(p => {
                if (p.tipo === 'partecipante') {
                    const card = document.createElement('div');
                    card.className = 'participant-card';
                    
                    // Stato della puntata
                    let bidStatus = 'Nessuna offerta';
                    let bidClass = 'bid-none';
                    
                    card.innerHTML = `
                        <div><strong>${p.nome}</strong></div>
                        <div>Stato: ${p.stato}</div>
                        <div class="bid-status ${bidClass}">${bidStatus}</div>
                    `;
                    
                    grid.appendChild(card);
                }
            });

            container.appendChild(grid);
        }

        function updateStats() {
            const connessi = gameState.connessi.filter(p => p.tipo === 'partecipante').length;
            document.getElementById('statConnessi').textContent = connessi;
            
            // TODO: Aggiornare altre statistiche dal database
            document.getElementById('statOfferte').textContent = '0';
            document.getElementById('statRounds').textContent = '0';
            document.getElementById('statCrediti').textContent = '0';
        }

        // Risultati e classifiche
        function mostraRisultatiRound(round, risultati) {
            const modal = document.getElementById('resultsModal');
            const title = document.getElementById('resultsTitle');
            const content = document.getElementById('resultsContent');

            title.textContent = `Risultati Round ${round}`;
            
            let html = '<table class="results-table"><thead><tr>';
            html += '<th>Giocatore</th><th>Vincitore</th><th>Offerta</th><th>Costo Finale</th><th>Condiviso</th>';
            html += '</tr></thead><tbody>';

            risultati.forEach(r => {
                html += `<tr>
                    <td><strong>${r.slot.replace('_', ' ')}</strong></td>
                    <td>${r.nome}</td>
                    <td>${r.offertaOriginale}</td>
                    <td>${r.costoFinale}</td>
                    <td>${r.condiviso ? '✅' : '❌'}</td>
                </tr>`;
            });

            html += '</tbody></table>';
            content.innerHTML = html;
            modal.style.display = 'flex';
        }

        async function mostraClassifica() {
            try {
                const response = await fetch('/api/classifica');
                const classifica = await response.json();

                const modal = document.getElementById('classificaModal');
                const content = document.getElementById('classificaContent');

                let html = '<table class="results-table"><thead><tr>';
                html += '<th>Pos</th><th>Nome</th><th>Punti</th><th>Giocatori</th><th>Crediti</th>';
                html += '</tr></thead><tbody>';

                classifica.forEach((p, index) => {
                    html += `<tr>
                        <td><strong>${index + 1}°</strong></td>
                        <td>${p.nome}</td>
                        <td>${p.punti_totali}</td>
                        <td>${p.giocatori_totali}/10</td>
                        <td>${p.crediti}</td>
                    </tr>`;
                });

                html += '</tbody></table>';
                content.innerHTML = html;
                modal.style.display = 'flex';
            } catch (error) {
                showNotification('Errore caricamento classifica', 'error');
            }
        }

        // Strumenti admin
        function vaiASetup() {
            window.location.href = '/setup';
        }

        async function esportaDati() {
            try {
                const response = await fetch('/api/export');
                const data = await response.json();
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `fantagts_export_${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
                showNotification('Dati esportati con successo', 'success');
            } catch (error) {
                showNotification('Errore durante export', 'error');
            }
        }

        function resetAste() {
            showConfirmModal(
                'Reset Aste',
                'Questa azione cancellerà tutte le aste e ripristinerà i crediti. Procedere?',
                async () => {
                    try {
                        const response = await fetch('/api/reset/aste', { method: 'POST' });
                        if (response.ok) {
                            showNotification('Aste resettate con successo', 'success');
                            location.reload();
                        } else {
                            showNotification('Errore durante reset', 'error');
                        }
                    } catch (error) {
                        showNotification('Errore di connessione', 'error');
                    }
                }
            );
        }

        function resetTotale() {
            showConfirmModal(
                'Reset Totale',
                'ATTENZIONE: Questa azione cancellerà TUTTI i dati del sistema. È irreversibile!',
                async () => {
                    try {
                        const response = await fetch('/api/reset/totale', { method: 'POST' });
                        if (response.ok) {
                            showNotification('Sistema resettato completamente', 'success');
                            setTimeout(() => window.location.href = '/setup', 2000);
                        } else {
                            showNotification('Errore durante reset', 'error');
                        }
                    } catch (error) {
                        showNotification('Errore di connessione', 'error');
                    }
                }
            );
        }

        // Utilities
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        function showConfirmModal(title, message, onConfirm) {
            document.getElementById('confirmTitle').textContent = title;
            document.getElementById('confirmMessage').textContent = message;
            document.getElementById('confirmBtn').onclick = () => {
                closeModal('confirmModal');
                onConfirm();
            };
            document.getElementById('confirmModal').style.display = 'flex';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Aggiorna stato ogni 30 secondi
        setInterval(caricaStatoIniziale, 30000);
    </script>
</body>
</html>